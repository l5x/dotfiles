#!/usr/bin/env bash
#
# @description build ledger-cli accounting system
#
# @import console/info
# @dependency git


# apt-get install build-essential cmake doxygen \
#     libboost-system-dev libboost-dev python-dev gettext git \
#     libboost-date-time-dev libboost-filesystem-dev \
#     libboost-iostreams-dev libboost-python-dev libboost-regex-dev \
#     libboost-test-dev libedit-dev libgmp3-dev libmpfr-dev texinfo

main () {
    strict  true
    verbose true

    if [[ -d "${HOME}/.ledger-dist" ]]
    then
        rm -rf "${HOME}/.ledger-dist"
    fi 

    mkdir -p "${HOME}/.ledger-dist/build"

    git clone https://github.com/ledger/ledger.git  "${HOME}/.ledger-dist/build"

    cd "${HOME}/.ledger-dist/build" || exit
    git checkout -b master origin/master

    ./acprep dependencies
    ./acprep update --prefix="${HOME}/.ledger-dist" -j2

    make install
    # git fetch origin refs/tags/0.5.6
    # git reset --hard FETCH_HEAD

    # PREFIX="${HOME}/.ledger-dist" make -j 2
    # PREFIX="${HOME}/.ledger-dist" make install

    _ info "Done."
}

onExit () {
    _ info "Removing temporary files and directories."

    # if [[ -d "${HOME}/.ledger-dist/build" ]]
    # then
    #     rm -rf "${HOME}/.ledger-dist/build"
    # fi 
}
