#!/usr/bin/env bash
#
# @description build polybar status bar
# @import console/info
# @dependency git

main () {
    strict  true
    verbose true

    if [[ -d "${HOME}/.polybar-dist" ]]
    then
        rm -rf "${HOME}/.polybar-dist"
    fi 

    mkdir -p "${HOME}/.polybar-dist/build"

    # sudo apt-get install -y --no-install-suggests --no-install-recommends --force-yes \
    # cmake \
    # cmake-data \
    # libasound2-dev \
    # libboost-dev \
    # libfreetype6-dev \
    # libiw-dev \
    # libmpdclient-dev \
    # libx11-xcb-dev \
    # libxcb-ewmh-dev \
    # libxcb-icccm4-dev \
    # libxcb-image0-dev \
    # libxcb-randr0-dev \
    # libxcb-util0-dev \
    # libxcb-xkb-dev \
    # libxcb1-dev \
    # python-xcbgen \
    # xcb-proto

    git clone --depth 1 --branch 3.0.5 --recursive https://github.com/jaagr/polybar  "${HOME}/.polybar-dist/build"

    cd "${HOME}/.polybar-dist/build" || exit
    cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX:PATH="${HOME}/.polybar-dist"
    make install

    _ info "Done."
}

onExit () {
    _ info "Removing temporary files and directories."

    if [[ -d "${HOME}/.polybar-dist/build" ]]
    then
        rm -rf "${HOME}/.polybar-dist/build"
    fi 
}
