#!/usr/bin/env bash
#
# @description build mutt e-mail client
# @import console/info
# @dependency git

main () {
    strict  true
    verbose true

    if [[ -d "${HOME}/.mutt-dist" ]]
    then
        rm -rf "${HOME}/.mutt-dist"
    fi 

    mkdir -p "${HOME}/.mutt-dist/build"

    # sudo apt-get install libgpgme11-dev libnotmuch-dev libtokyocabinet-dev libgdbm-dev libdb-dev libcaca-dev libsasl2-dev

    cd "${HOME}/.mutt-dist" || exit
    # wget --https-only -nv -t 2 --show-progress "https://bitbucket.org/mutt/mutt/downloads/mutt-1.6.1.tar.gz" -O "${HOME}/.mutt-dist/mutt.tgz"
    # tar -zxf "${HOME}/.mutt-dist/mutt.tgz" --strip-components=1 -C "${HOME}/.mutt-dist/build"

    git clone --depth 1 https://github.com/neomutt/neomutt "${HOME}/.mutt-dist/build"

    cd "${HOME}/.mutt-dist/build" || exit

    "${HOME}/.mutt-dist/build/prepare"    \
            --prefix="${HOME}/.mutt-dist" \
            --enable-pop                  \
            --enable-imap                 \
            --enable-smtp                 \
            --enable-hcache               \
            --with-regex                  \
            --enable-locales-fix          \
            --with-ssl                    \
            --with-sasl                   \
            --enable-gpgme                \
            --with-slang                  \
            --enable-sidebar              \
            --enable-external-dotlock     \
            --with-sasl                   \
            --enable-cram \
            --enable-digest \
            --enable-plain \
            --enable-login

    make -j 4
    make install

    _ info "Done."
}

onExit () {
    _ info "Removing temporary files and directories."

    # if [[ -f "${HOME}/.mutt-dist/mutt.tgz" ]]
    # then
    #     rm -f "${HOME}/.mutt-dist/mutt.tgz"
    # fi
    #
    if [[ -d "${HOME}/.mutt-dist/build" ]]
    then
        rm -rf "${HOME}/.mutt-dist/build"
    fi 
}
